
<!DOCTYPE html>
<html lang="ru">
    <head>
        <title>Chat</title>
        <link rel="stylesheet" href="{{ url_for('static', path='css/main.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', path='css/style-desktop.css') }}" media="only screen and (min-width:721px)">
    </head>
    <body>
        <div class="whole page-chats" style="display:none" id="page-chats">
            <div id="main-columns" class="tabs-container" data-animation="navigation">
                <div class="tabs-tab main-column" id="column-center">
                    <div class="chats-container tabs-container" data-animation="navigation"><div class="chat tabs-tab active" data-type="chat"><div class="chat-background"><div class="chat-background-item is-pattern is-dark is-visible"><canvas width="50" height="50" data-colors="#fec496,#dd6cb9,#962fbf,#4f5bd5" class="chat-background-item-canvas chat-background-item-color-canvas" style="--opacity-max:0.25;"></canvas><canvas data-original-height="975" width="763" height="975" class="chat-background-item-canvas chat-background-item-pattern-canvas"></canvas></div></div><div class="sidebar-header topbar" data-floating="0" style="--utils-width:144px;"><div class="chat-info-container"><button class="btn-icon tgico-left sidebar-close-button"></button><div class="chat-info"><div class="person"><avatar-element class="avatar-like avatar-42 person-avatar avatar-relative" data-peer-id="1407046726" dir="auto" data-color=""><img class="avatar-photo" src="blob:https://web.telegram.org/a73178fa-de65-423d-82ed-907eb4ed1e2a"></avatar-element><div class="content"><div class="top"><div class="user-title"><span class="peer-title" dir="auto" data-peer-id="1407046726" data-dialog="1" data-with-icons="1" data-thread-id="0">Relabs</span></div></div><div class="bottom"><div class="info"><span class="i18n">last seen 18 minutes ago</span></div></div></div></div></div><div class="chat-utils"><div class="pinned-message pinned-container hide"><button class="pinned-container-close pinned-message-close btn-icon tgico-close"></button><div class="pinned-container-wrapper rp"><div class="c-ripple"></div><div class="pinned-message-border"><div class="pinned-message-border-wrapper-1" style=""></div></div><div class="pinned-message-content pinned-container-content"><div class="animated-super pinned-message-media-container"></div><div class="pinned-message-title pinned-container-title" dir="auto"><span class="i18n">Pinned Message</span> <div class="animated-counter"></div></div><div class="pinned-message-subtitle pinned-container-subtitle" dir="auto"><div class="animated-super"></div></div></div><div class="pinned-container-wrapper-utils"><button class="btn-icon tgico-pinlist pinned-container-close pinned-message-pinlist"></button><button class="pinned-container-close pinned-message-close btn-icon tgico-close"></button></div></div></div><button class="btn-primary btn-color-primary chat-join hide rp"><div class="c-ripple"></div></button><button class="btn-icon tgico-pinlist rp"><div class="c-ripple"></div></button><button class="btn-icon tgico-phone rp"><div class="c-ripple"></div></button><button class="btn-icon tgico-videochat rp hide"><div class="c-ripple"></div></button><button class="btn-icon tgico-mute rp hide" style="display: none;"><div class="c-ripple"></div></button><button class="btn-icon tgico-search rp"><div class="c-ripple"></div></button><button class="btn-icon tgico-more rp btn-menu-toggle"><div class="c-ripple"></div></button></div></div><div class="pinned-audio pinned-container hide"><div class="pinned-container-wrapper rp"><div class="c-ripple"></div><button class="btn-icon tgico-fast_rewind active"></button><button class="btn-icon active pinned-audio-ico tgico"></button><button class="btn-icon tgico-fast_forward active"></button><div class="pinned-audio-content pinned-container-content"><div class="pinned-audio-title pinned-container-title" dir="auto"></div><div class="pinned-audio-subtitle pinned-container-subtitle" dir="auto"></div></div><div class="pinned-audio-progress-wrapper"><div class="progress-line use-transform pinned-audio-progress"><div class="progress-line__filled"></div><input class="progress-line__seek" type="range" step="0.016666666666666666" min="0" max="1"></div></div><div class="pinned-container-wrapper-utils"><div class="btn-icon player-volume pinned-audio-volume active"><div class="pinned-audio-volume-tunnel"></div><span class="player-volume__icon tgico-volume_off"></span><div class="progress-line-container"><div class="progress-line"><div class="progress-line__filled" style="width: 0%;"></div><input class="progress-line__seek" type="range" step="0.01" min="0" max="1"></div></div></div><button class="btn-icon tgico-playback_2x"></button><button class="btn-icon tgico-audio_repeat"></button><button class="pinned-container-close pinned-audio-close btn-icon tgico-close"></button></div></div></div></div><div class="bubbles scrolled-down has-groups has-sticky-dates"><div class="scrollable scrollable-y"><div class="bubbles-inner has-rights"><section class="bubbles-date-group"><div class="bubble service is-date is-sticky"><div class="bubble-content"><div class="service-msg"><span class="i18n" dir="auto">January 23</span></div></div></div><div class="bubble service is-date is-fake"><div class="bubble-content"><div class="service-msg"><span class="i18n" dir="auto">January 23</span></div></div></div><div class="sticky_sentinel sticky_sentinel--top"></div><div class="bubbles-group"><div data-mid="5595725823" data-peer-id="1407046726" data-timestamp="1674482503" class="bubble is-read hide-name is-out can-have-tail is-group-first is-group-last"><div class="bubble-content-wrapper" style=""><div class="bubble-content"><div class="message spoilers-container document-message"><div class="document-container" data-mid="5595725823" data-peer-id="1407046726"><div class="document-wrapper"><div class="document-message" dir="auto">Здравствуйте!
                        Связываюсь с вами для тестового задания
                        Вот моё резюме:<span class="time tgico"><span class="i18n" dir="auto">17:01</span><div
                                class="inner tgico" title="23 January 2023, 17:01:43"><span class="i18n" dir="auto">17:01</span></div></span>
                    </div>
                        <div class="document ext-pdf document-with-thumb downloaded" data-doc-id="5366295838005930837">
                            <div class="document-ico media-container"><img class="media-photo document-thumb"
                                                                           src="blob:https://web.telegram.org/6712d31a-3788-443d-8eeb-eb279a3ac9f4">
                            </div>

                            <div class="document-name">
                                <middle-ellipsis-element data-font-weight="500" data-font-size="16"
                                                         data-size-type="documentName"
                                                         title="Климов Александр Евгеньевич.pdf">Климов
                                    Алекса…вгеньевич.pdf
                                </middle-ellipsis-element>
                            </div>
                            <div class="document-size"><span style=""><span class="i18n">376 KB</span> · <span
                                    style="visibility: hidden;"> / <span class="i18n">376 KB</span></span></span></div>
                        </div>
                    </div>
                    </div>
                    </div>
                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                            <use href="#message-tail-filled"></use>
                        </svg>
                    </div>
                    </div>
                    </div>
                    </div>
                        <div class="bubbles-group">
                            <div data-mid="5595856895" data-peer-id="1407046726" data-timestamp="1674483967"
                                 class="bubble hide-name is-in can-have-tail is-group-first">
                                <div class="bubble-content-wrapper" style="">
                                    <div class="bubble-content">
                                        <div class="message spoilers-container" dir="auto">Добрый день. Высылаем
                                            тестовое задание. Срок выполнения 3 дня. Ответ ссылкой на гитхаб<span
                                                    class="time tgico"><span class="i18n" dir="auto">17:26</span><div
                                                    class="inner tgico" title="23 January 2023, 17:26:07"><span
                                                    class="i18n" dir="auto">17:26</span></div></span></div>
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div data-mid="5595922431" data-peer-id="1407046726" data-timestamp="1674483981"
                                 class="bubble hide-name is-in can-have-tail is-group-last">
                                <div class="bubble-content-wrapper" style="">
                                    <div class="bubble-content">
                                        <div class="message spoilers-container" dir="auto">Задача следующая. С
                                            использованием fastapi необходимо сделать веб-страницу сочетающую из:
                                            1. Формы с текстовым полем
                                            2. Списком сообщений пронумерованных с 1

                                            Страница подключается к серверу по WebSocket.
                                            С помощью формы вы можете отправить сообщение на сервер, где оно будет
                                            принято и добавлен порядковый номер этого сообщения.
                                            Далее сообщение с порядковым номером отправляется на страницу и отображается
                                            в списке.

                                            При перезагрузке страницы данные о номерации теряются и начинается с 1.

                                            Страница должна быть динамической, обрабатывать все действия без
                                            перезагрузки. Имеется ввиду что при отправке сообщения на сервер через
                                            вебсокет страница не должна перезагружаться.&nbsp;
                                            Взаимодействие с сервером по вебсокет нужно реализовать с использованием
                                            JSON. Формат и именование полей не важно. можно использовать любые.<span
                                                    class="time tgico"><span class="i18n" dir="auto">17:26</span><div
                                                    class="inner tgico" title="23 January 2023, 17:26:21"><span
                                                    class="i18n" dir="auto">17:26</span></div></span></div>
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bubbles-group">
                            <div data-mid="5595987967" data-peer-id="1407046726" data-timestamp="1674484062"
                                 class="bubble is-read hide-name is-out can-have-tail is-group-first is-group-last">
                                <div class="bubble-content-wrapper" style="">
                                    <div class="bubble-content">
                                        <div class="message spoilers-container" dir="auto">3 дня начиная с сегодня? Или
                                            с завтра? Или с сегодня 17:27?)<span class="time tgico"><span class="i18n"
                                                                                                          dir="auto">17:27</span><div
                                                    class="inner tgico" title="23 January 2023, 17:27:42"><span
                                                    class="i18n" dir="auto">17:27</span></div></span></div>
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bubbles-group">
                            <div data-mid="5596053503" data-peer-id="1407046726" data-timestamp="1674484117"
                                 class="bubble hide-name is-in can-have-tail is-group-first is-group-last">
                                <div class="bubble-content-wrapper" style="">
                                    <div class="bubble-content">
                                        <div class="message spoilers-container" dir="auto">С сегодня с 17:26<span
                                                class="time tgico"><span class="i18n" dir="auto">17:28</span><div
                                                class="inner tgico" title="23 January 2023, 17:28:37"><span class="i18n"
                                                                                                            dir="auto">17:28</span></div></span>
                                        </div>
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bubbles-group">
                            <div data-mid="5596119039" data-peer-id="1407046726" data-timestamp="1674484127"
                                 class="bubble is-read hide-name is-out can-have-tail is-group-first is-group-last">
                                <div class="bubble-content-wrapper">
                                    <div class="bubble-content">
                                        <div class="message spoilers-container" dir="auto">Хорошо <img
                                                src="assets/img/emoji/1f44c.png" class="emoji" alt="👌"><span
                                                class="time tgico"><span class="i18n" dir="auto">17:28</span><div
                                                class="inner tgico" title="23 January 2023, 17:28:47"><span class="i18n"
                                                                                                            dir="auto">17:28</span></div></span>
                                        </div>
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    </div>
                    </div>
                    </div>
                        <div class="chat-input">
                            <div class="chat-input-container">
                                <div class="rows-wrapper-wrapper">
                                    <div class="rows-wrapper chat-input-wrapper">
                                        <svg viewBox="0 0 11 20" width="11" height="20" class="bubble-tail">
                                            <use href="#message-tail-filled"></use>
                                        </svg>
                                        <div class="autocomplete-helper z-depth-1 autocomplete-peer-helper bot-commands"></div>
                                        <div class="reply-wrapper">
                                            <button class="btn-icon rp">
                                                <div class="c-ripple"></div>
                                            </button>
                                            <button class="btn-icon tgico-close reply-cancel"></button>
                                            <div class="btn-menu">
                                                <form>
                                                    <div class="btn-menu-item rp-overflow"><span
                                                            class="i18n btn-menu-item-text">Chat.Alert.Forward.Action.Show1</span><label
                                                            class="checkbox-field checkbox-without-caption"><input
                                                            class="checkbox-field-input" type="radio" name="author"
                                                            value="1">
                                                        <div class="checkbox-box">
                                                            <div class="checkbox-box-border"></div>
                                                            <div class="checkbox-box-background"></div>
                                                            <svg class="checkbox-box-check" viewBox="0 0 24 24">
                                                                <use href="#check" x="-1"></use>
                                                            </svg>
                                                        </div>
                                                    </label></div>
                                                    <div class="btn-menu-item rp-overflow"><span
                                                            class="i18n btn-menu-item-text">Chat.Alert.Forward.Action.Hide1</span><label
                                                            class="checkbox-field checkbox-without-caption"><input
                                                            class="checkbox-field-input" type="radio" name="author"
                                                            value="0">
                                                        <div class="checkbox-box">
                                                            <div class="checkbox-box-border"></div>
                                                            <div class="checkbox-box-background"></div>
                                                            <svg class="checkbox-box-check" viewBox="0 0 24 24">
                                                                <use href="#check" x="-1"></use>
                                                            </svg>
                                                        </div>
                                                    </label></div>
                                                    <hr>
                                                </form>
                                                <form>
                                                    <div class="btn-menu-item rp-overflow"><span
                                                            class="i18n btn-menu-item-text">Chat.Alert.Forward.Action.ShowCaption</span><label
                                                            class="checkbox-field checkbox-without-caption"><input
                                                            class="checkbox-field-input" type="radio" name="caption"
                                                            value="1">
                                                        <div class="checkbox-box">
                                                            <div class="checkbox-box-border"></div>
                                                            <div class="checkbox-box-background"></div>
                                                            <svg class="checkbox-box-check" viewBox="0 0 24 24">
                                                                <use href="#check" x="-1"></use>
                                                            </svg>
                                                        </div>
                                                    </label></div>
                                                    <div class="btn-menu-item rp-overflow"><span
                                                            class="i18n btn-menu-item-text">Chat.Alert.Forward.Action.HideCaption</span><label
                                                            class="checkbox-field checkbox-without-caption"><input
                                                            class="checkbox-field-input" type="radio" name="caption"
                                                            value="0">
                                                        <div class="checkbox-box">
                                                            <div class="checkbox-box-border"></div>
                                                            <div class="checkbox-box-background"></div>
                                                            <svg class="checkbox-box-check" viewBox="0 0 24 24">
                                                                <use href="#check" x="-1"></use>
                                                            </svg>
                                                        </div>
                                                    </label></div>
                                                    <hr>
                                                </form>
                                                <div class="btn-menu-item rp-overflow tgico-replace"><span
                                                        class="i18n btn-menu-item-text">Forward to Another Chat</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="autocomplete-helper z-depth-1 stickers-helper"></div>
                                        <div class="autocomplete-helper z-depth-1 emoji-helper"></div>
                                        <div class="autocomplete-helper z-depth-1 autocomplete-peer-helper commands-helper"></div>
                                        <div class="autocomplete-helper z-depth-1 autocomplete-peer-helper mentions-helper"></div>
                                        <div class="autocomplete-helper z-depth-1 inline-helper"></div>
                                        <div class="new-message-wrapper" data-offset="commands">
                                            <button class="btn-icon tgico-none toggle-emoticons"></button>
                                            <div class="input-message-container">
                                                <div class="input-message-input i18n scrollable scrollable-y no-scrollbar"
                                                     contenteditable="true" dir="auto" data-placeholder="Message"
                                                     style="transition-duration: 181ms; height: 37px;"
                                                     data-peer-id="1407046726"></div>
                                                <div contenteditable="true" tabindex="-1"
                                                     class="input-message-input i18n scrollable scrollable-y input-field-input-fake"></div>
                                            </div>
                                            <button class="btn-icon tgico-scheduled btn-scheduled float hide show"></button>
                                            <button class="btn-icon tgico-botcom toggle-reply-markup float hide show"></button>
                                            <div class="btn-icon btn-menu-toggle attach-file tgico-attach"></div>
                                            <div class="record-time"></div>
                                            <input type="file" multiple="" style="display: none;"></div>
                                    </div>
                                </div>
                                <div class="fake-wrapper fake-rows-wrapper"></div>
                                <div class="fake-wrapper fake-selection-wrapper"></div>
                                <button class="btn-circle btn-corner z-depth-1 bubbles-corner-button chat-secondary-button bubbles-go-down tgico-arrow_down rp">
                                    <div class="c-ripple"></div>
                                    <span class="badge badge-24 badge-primary"></span></button>
                                <div class="chat-input-control chat-input-wrapper">
                                    <button class="btn-primary btn-transparent text-bold chat-input-control-button rp">
                                        <div class="c-ripple"></div>
                                        <span class="i18n">START</span></button>
                                    <div class="reply-in-topic-overlay hide"><span class="i18n">Reply to message in topics</span>
                                    </div>
                                    <button class="btn-primary btn-transparent text-bold chat-input-control-button tgico-unpin rp hide">
                                        <span class="i18n">Unpin All Messages</span></button>
                                </div>
                                <button class="btn-circle btn-corner z-depth-1 bubbles-corner-button chat-secondary-button bubbles-go-mention tgico-mention rp">
                                    <div class="c-ripple"></div>
                                    <span class="badge badge-24 badge-primary"></span></button>
                                <button class="btn-icon tgico-binfilled btn-circle btn-record-cancel chat-secondary-button rp">
                                    <div class="c-ripple"></div>
                                </button>
                                <div class="btn-send-container">
                                    <div class="record-ripple"></div>
                                    <button class="btn-icon tgico-none btn-circle btn-send animated-button-icon rp record">
                                        <span class="tgico tgico-send"></span>
                                        <span class="tgico tgico-schedule"></span>
                                        <span class="tgico tgico-check"></span>
                                        <span class="tgico tgico-microphone_filled"></span>
                                        <div class="c-ripple"></div>
                                    </button>
                                    <div class="btn-menu menu-send top-left">
                                        <div class="btn-menu-item rp-overflow tgico-mute"><span
                                                class="i18n btn-menu-item-text">Send Without Sound</span></div>
                                        <div class="btn-menu-item rp-overflow tgico-schedule"><span
                                                class="i18n btn-menu-item-text">Schedule Message</span></div>
                                        <div class="btn-menu-item rp-overflow tgico-schedule"><span
                                                class="i18n btn-menu-item-text">Set a Reminder</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <h1>WebSocket Chat</h1>
        <form action="" onsubmit="sendMessage(event)">
            <input type="text" id="messageText" autocomplete="off"/>
            <label for="messageText">Pups</label>
            <button>Send</button>
        </form>
        <ul id='messages'>
        </ul>
        <script>
            var ws = new WebSocket(`ws://localhost:8000/ws`);
            ws.onmessage = function(event) {
                var messages = document.getElementById('messages')
                var message = document.createElement('li')
                message_json = JSON.parse(event.data)
                message_id = message_json['message_id']
                message_out = message_json['send_message']
                var content = document.createTextNode('id: '+ message_id + ', message: ' + message_out)
                message.appendChild(content)
                messages.appendChild(message)
            };
            function sendMessage(event) {
                var input = document.getElementById("messageText");
                let message_data = {send_message: input.value,};
                let json_message = JSON.stringify(message_data);
                ws.send(json_message)
                input.value = ''
                event.preventDefault()
            }
        </script>
    </body>
</html>